<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>DB Alert Demo</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; max-width: 900px; }
    .row { display: flex; gap: .75rem; align-items: center; flex-wrap: wrap; }
    .btn { padding: .6rem 1rem; border: 0; border-radius: 8px; cursor: pointer; background:#111; color:#fff; }
    pre { background: #f8f8f8; padding: 1rem; border-radius: 8px; overflow:auto; max-height: 320px;}
    .meta { color:#555; font-size:.9rem; }
    .badge { display:inline-block; padding:.2rem .5rem; border-radius:6px; background:#eee; margin-left:.5rem;}
  </style>
</head>
<body>
  <h1>ðŸš¨ Demo DB Alert</h1>
  <div class="card">
    <h2>{{ payload.alerts[0].labels.alertname }}</h2>
    <div class="meta">
      Severity: <b>{{ payload.alerts[0].labels.severity }}</b> Â· Env: <b>{{ payload.alerts[0].labels.env }}</b>
    </div>
    <p>{{ payload.alerts[0].annotations.summary }}</p>
    <p class="meta">{{ payload.alerts[0].annotations.description }}</p>

    <div class="row" style="margin-top:.5rem;">
      <form action="/fix-test" method="post"><button class="btn" type="submit">Fix in Test</button></form>
      <form action="/promote-prod" method="post"><button class="btn" type="submit">Promote to Prod</button></form>
      <span class="meta">Agent edits <code>.env.test</code>/<code>.env.prod</code> and shows the unified diff below.</span>
    </div>

    {% if meta and meta.get("stage") %}
      <p class="meta">Stage: <b>{{ meta.get("stage") }}</b>
        <span class="badge">Changed: {{ meta.get("changed") }}</span>
        <span class="badge">OK after fix: {{ meta.get("ok") }}</span>
      </p>
    {% endif %}

    <h3 style="margin-top:1rem;">Agent Logs</h3>
    <pre>{{ logs }}</pre>

    <h3>Change Diff (.patch)</h3>
    <pre>{{ diff }}</pre>
  </div>
</body>
</html>
